<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Messages - Mind Battle</title>
<style>
body {
  margin:0; padding:0;
  font-family:'Inter', sans-serif;
  min-height:100vh;
  background: linear-gradient(135deg,#2c003e,#4b0066);
  color:#fff;
  display:flex;
  flex-direction:column;
}
nav {
  width:100%;
  background: rgba(0,0,0,0.5);
  padding:0.8rem 1.5rem;
  display:flex;
  align-items:center;
}
nav .logo img {height:35px;}
nav ul {list-style:none; display:flex; gap:0.8rem;}
nav a {text-decoration:none; color:#fff; padding:0.5rem 0.9rem; border-radius:5px;}
main {flex:1; padding:20px; max-width:800px; margin:auto;}
h1 {text-align:center; margin-bottom:20px;}
#messagesList {display:flex; flex-direction:column; gap:15px;}
.message-card {
  border-radius:12px;
  background: rgba(0,0,0,0.6);
  padding:15px;
  box-shadow:0 0 10px rgba(0,0,0,0.5);
  transition:0.3s;
}
.message-card:hover {background: rgba(0,0,0,0.8);}
.message-card h3 {margin-bottom:5px;}
.message-card p {margin-bottom:8px;}
.message-card small {color:#ccc;}
.bg-particles {
  position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; overflow:hidden;
}
.particle {position:absolute; width:10px; height:10px; background: rgba(255,255,255,0.15); border-radius:50%; animation: float 12s infinite;}
@keyframes float {0% {transform: translateY(0);} 50% {transform: translateY(-100px);} 100% {transform: translateY(0);}}
</style>
</head>
<body>

<div class="bg-particles">
  <div class="particle" style="top:10%; left:15%; animation-duration:14s;"></div>
  <div class="particle" style="top:40%; left:70%; animation-duration:16s;"></div>
  <div class="particle" style="top:80%; left:50%; animation-duration:18s;"></div>
  <div class="particle" style="top:60%; left:10%; animation-duration:12s;"></div>
  <div class="particle" style="top:30%; left:80%; animation-duration:20s;"></div>
</div>

<nav>
  <div class="logo">
    <img src="images/MindBattle.png" alt="Mind Battle Logo">
  </div>
  <ul>
    <li><a href="dashboard.html">Dashboard</a></li>
  </ul>
</nav>

<main>
  <h1>Messages & Announcements</h1>
  <div id="messagesList"></div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getFirestore, collection, query, orderBy, onSnapshot, doc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD8-6fIW9F7vw7NO5p9_hCitfqesLU5f0g",
  authDomain: "mind-battle-32801.firebaseapp.com",
  projectId: "mind-battle-32801",
  appId: "1:134995556582:web:1ed2267687a197f1b0e327"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const messagesList = document.getElementById("messagesList");

onAuthStateChanged(auth, async user => {
  if(!user){ window.location.href="signin.html"; return; }

  const q = query(collection(db,"announcements"), orderBy("timestamp","desc"));
  onSnapshot(q, snapshot => {
    messagesList.innerHTML="";
    snapshot.forEach(async docSnap=>{
      const data = docSnap.data();
      const card = document.createElement("div");
      card.className="message-card";

      const title = document.createElement("h3");
      title.textContent = data.title || "Announcement";

      const msg = document.createElement("p");
      msg.textContent = data.message;

      const date = document.createElement("small");
      if(data.timestamp?.toDate) date.textContent = "ðŸ“… " + data.timestamp.toDate().toLocaleString();

      card.append(title,msg,date);
      messagesList.appendChild(card);

      if(!data.readBy?.includes(user.uid)){
        await updateDoc(doc(db,"announcements",docSnap.id),{
          readBy: arrayUnion(user.uid)
        });
      }
    });
  });
});
</script>
</body>
</html>
